/**Minimal version generated for
* canvas module. version 0.1.0(build)
**/

var Canvas=function(e){var t,n,r,i;$("#resetControls").click(this.resetControls);$("#startAnimation").click(this.startAnimation);$("#pauseAnimation").click(this.pauseAnimation);$("#stopAnimation").click(this.stopAnimation);$("#switchCamera").click(this.switchCamera);$("#goToFrame").click(this.goToFrame)};Canvas.prototype.timeSteps=JSONObj.frames[0].simulation_matrix.length;Canvas.prototype.frames=new THREE.Object3D;Canvas.prototype.frames.name="frames";Canvas.prototype.grid=new THREE.Object3D;Canvas.prototype.grid.name="Grid";Canvas.prototype.cameras=new THREE.Object3D;Canvas.prototype.cameras.name="Cameras";Canvas.prototype.cameraPoints=new THREE.Object3D;Canvas.prototype.cameraPoints.name="Camera Points";Canvas.prototype.lights=new THREE.Object3D;Canvas.prototype.lights.name="Lights";Canvas.prototype.lightPoints=new THREE.Object3D;Canvas.prototype.lightPoints.name="Light Points";Canvas.prototype.scene=new THREE.Scene;Canvas.prototype.animationCounter=0;Canvas.prototype.cameraCounter=0;Canvas.prototype.animationSpeed=parseInt($("#animationSpeed").val());Canvas.prototype.initialize=function(){this.renderer=new THREE.WebGLRenderer;this.renderer.setSize(JSONObj.width,JSONObj.height);this.container=$("#container");this.container.append(this.renderer.domElement);var e=new THREE.MeshLambertMaterial({color:16777215});var t=JSONObj.cameras[0];this.aspect_ratio=JSONObj.width/JSONObj.height;switch(t.type){case"PerspectiveCamera":this.primaryCamera=new THREE.PerspectiveCamera(t.fov,this.aspect_ratio,t.near,t.far);this.primaryCamera.matrix.elements=t.simulation_matrix[0];this.primaryCamera.position.x=0;this.primaryCamera.position.y=0;this.primaryCamera.position.z=100;break}this.scene.add(this.primaryCamera);this.primaryControls=new THREE.TrackballControls(this.primaryCamera,this.renderer.domElement);var n=new THREE.GridHelper(100,5);n.position.set(0,0,0);n.material.color=new THREE.Color(16777215);n.rotation.y=Math.PI/2;this.grid.add(n);this.scene.add(this.grid);this.axes=new THREE.AxisHelper(JSONObj.height);this.axes.name="Axes";this.scene.add(this.axes);this.renderer.render(this.scene,this.primaryCamera);this.primaryLight=new THREE.PointLight(16777215);this.primaryLight.position.set(10,10,-10);this.scene.add(this.primaryLight);var r=new THREE.SphereGeometry(2,100,100);var i=new THREE.MeshBasicMaterial(16777215);this.lightPoint=new THREE.Mesh(r,i);this.lightPoint.position.set(10,10,-10);this.scene.add(this.lightPoint);primaryControls=this.primaryControls;primaryCamera=this.primaryCamera;renderer=this.renderer;scene=this.scene;$("#frameCount").append("<h2>Total Frames: "+this.timeSteps+"</h2>");$("#currentFrame").append("<h2>Current Frame: "+this.animationCounter+"</h2>")};Canvas.prototype.addControls=function(){primaryControls.update();renderer.render(scene,primaryCamera);this.controlsID=requestAnimationFrame(Canvas.prototype.addControls)};Canvas.prototype.resetControls=function(){primaryControls.reset()};Canvas.prototype.addCameras=function(){for(var e in JSONObj.cameras){var t=JSONObj.cameras[e];switch(t.type){case"PerspectiveCamera":var n=new THREE.PerspectiveCamera(t.fov,this.aspect_ratio,t.near,t.far);var r=new Float32Array(t.simulation_matrix[0]);var i=new THREE.Matrix4;i.elements=r;n.applyMatrix(i);case"OrthoGraphicCamera":var n=new THREE.OrthographicCamera(JSONObj.width/-2,JSONObj.width/2,JSONObj.height/2,JSONObj.height/-2,t.near,t.far);var r=new Float32Array(t.simulation_matrix[0]);var i=new THREE.Matrix4;i.elements=r;n.applyMatrix(i)}console.log(n);var s=new THREE.MeshLambertMaterial(16777215);var o=new THREE.CubeGeometry(2,2);var u=new THREE.Mesh(o,s);u.position=n.position;this.cameraPoints.add(u);this.cameras.add(n)}this.scene.add(this.cameras)};Canvas.prototype.addLights=function(){for(var e in JSONObj.lights){var t=JSONObj.lights[e];switch(t.type){case"PointLight":var n=(new THREE.Color).setRGB(t.color[0],t.color[1],t.color[2]);var r=new THREE.PointLight(n);var i=new Float32Array(t.simulation_matrix[0]);var s=new THREE.Matrix4;s.elements=i;r.applyMatrix(s);var o=new THREE.SphereGeometry(1,100,100);var u=new THREE.MeshBasicMaterial(n);var a=new THREE.Mesh(o,u);a.position=r.position}this.lights.add(r);this.lightPoints.add(a)}this.scene.add(this.lights)};Canvas.prototype.addFrames=function(){for(var e in JSONObj.frames){var t=JSONObj.frames[e];console.log(t);console.log(t.shape);var n=(new THREE.Color).setRGB(t.shape.color[0],t.shape.color[1],t.shape.color[2]);var r=new THREE.MeshLambertMaterial({color:t.shape.color,opacity:.5});switch(t.shape.type){case"Cube":var i=new THREE.CubeGeometry(t.shape.length,t.shape.length,t.shape.length,50,50,50);break;case"Cylinder":var i=new THREE.CylinderGeometry(t.shape.radius,t.shape.radius,t.shape.length,50,50);break;case"Cone":var i=new THREE.CylinderGeometry(t.shape.radius,t.shape.radius/100,t.shape.length,50,50);break;case"Sphere":var i=new THREE.SphereGeometry(t.shape.radius,100,100);break;case"Circle":var i=new THREE.SphereGeometry(t.shape.radius,8);break;case"Plane":var i=new THREE.PlaneGeometry(t.shape.length,t.shape.width,100);break;case"Tetrahedron":var i=new THREE.TetrahedronGeometry(t.shape.radius);break;case"Octahedron":var i=new THREE.OctahedronGeometry(t.shape.radius);break;case"Icosahedron":var i=new THREE.IcosahedronGeometry(t.shape.radius);break;case"Torus":var i=new THREE.TorusGeometry(t.shape.radius,t.shape.tube_radius,100);break;case"TorusKnot":var i=new THREE.TorusKnotGeometry(t.shape.radius,t.shape.tube_radius,100);break}var s=new THREE.Mesh(i,r);var o=new Float32Array(t.simulation_matrix[0]);var u=new THREE.Matrix4;u.elements=o;s.matrix.identity();s.applyMatrix(u);this.frames.add(s)}this.scene.add(this.frames);for(var e in this.frames.children){console.log("Auto Update activated");this.frames.children[e].matrixAutoUpdate=false}};Canvas.prototype.startAnimation=function(){$("#startAnimation").unbind("click");for(var e in JSONObj.frames){Canvas.prototype._animate(e,Canvas.prototype.animationCounter)}Canvas.prototype.animationCounter++;$("#currentFrame").html("Current Frame: "+Canvas.prototype.animationCounter);Canvas.prototype.animationID=requestAnimationFrame(Canvas.prototype.startAnimation);if(Canvas.prototype.animationCounter>=Canvas.prototype.timeSteps)if($("#isLooped").is(":checked"))Canvas.prototype.animationCounter=0;else{cancelAnimationFrame(Canvas.prototype.animationID);Canvas.prototype.animationCounter=0}};Canvas.prototype._animate=function(e,t){var n=JSONObj.frames[e].simulation_matrix[t];var r=new THREE.Matrix4;r.elements=n;Canvas.prototype.scene.getObjectByName("frames").children[e].matrix.identity();Canvas.prototype.scene.getObjectByName("frames").children[e].applyMatrix(r)};Canvas.prototype.pauseAnimation=function(){cancelAnimationFrame(Canvas.prototype.animationID);Canvas.prototype.animationID=undefined;$("#startAnimation").click(Canvas.prototype.startAnimation)};Canvas.prototype.stopAnimation=function(){Canvas.prototype.animationCounter=0;cancelAnimationFrame(Canvas.prototype.animationID);Canvas.prototype.animationID=undefined;for(var e in JSONObj.frames){Canvas.prototype._animate(e,0)}$("#startAnimation").click(Canvas.prototype.startAnimation)};Canvas.prototype._transform=function(e,t){var n=JSONObj.frames[e].simulation_matrix[t];this.frames.children[e].matrix.elements=n}